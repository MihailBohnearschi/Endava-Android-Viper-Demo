package com.endava.viperdemo.application.dagger;

import com.endava.viperdemo.api.TaskApi;
import com.endava.viperdemo.utils.rx.RxSchedulers;
import com.google.gson.Gson;
import dagger.Module;
import dagger.Provides;
import okhttp3.OkHttpClient;
import retrofit2.Retrofit;
import retrofit2.adapter.rxjava.RxJavaCallAdapterFactory;
import retrofit2.converter.gson.GsonConverterFactory;

@Module
class RestServiceModule {

  private static final String BASE_URL = "https://endava-demo.herokuapp.com/";

  @AppScope
  @Provides
  public TaskApi taskApi(Gson gson, OkHttpClient okHttpClient, RxSchedulers rxSchedulers) {
    Retrofit retrofit = new Retrofit.Builder().addCallAdapterFactory(
      RxJavaCallAdapterFactory.createWithScheduler(rxSchedulers.network()))
      .addConverterFactory(GsonConverterFactory.create(gson))
      .baseUrl(BASE_URL)
      .client(okHttpClient)
      .build();
    return retrofit.create(TaskApi.class);
  }
}